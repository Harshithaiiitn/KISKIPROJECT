<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <link rel="apple-touch-icon" sizes="76x76" href="../static/assets/img/apple-icon.png">
  <link rel="icon" type="image/png" href="../static/assets/img/favicon.png">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>
    Portfolio Overview
  </title>
  <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
  <!--     Fonts and icons     -->
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
  <!-- CSS Files -->
  <link href="../static/assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="../static/assets/css/now-ui-dashboard.css?v=1.3.0" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
  .panel-header-lg{
        height: 500px !important;
    }
    .main-panel > .content
    {
        min-height: calc(100vh - 750px) !important;
    }
    .sidebar
    {
        background-color:red !important;
    }

  </style>
</head>

<body class="" onload="table_data('30/08/2019');document.getElementById('dt').value='30/08/2019';">
  <div class="wrapper ">
    <div class="sidebar" data-color="orange">
      <!--
        Tip 1: You can change the color of the sidebar using: data-color="blue | green | orange | red | yellow"
    -->
      <div class="logo">
        <a  href="{% url 'firstpage'%}">
            <img src="../static/images/ghclogo.png" height=70 width=70>
            
        </a>
        
      </div>
      <div class="sidebar-wrapper" id="sidebar-wrapper">
        <ul class="nav">
          <li class="active ">
            <a href="{% url 'firstpage'%}">
              <!-- <i class="now-ui-icons design_app"></i> -->
              <p>Portfolio Overview</p>
            </a>
          </li>
          <li>
            <a href="{% url 'secondpage'%}">
              <!-- <i class="now-ui-icons education_atom"></i> -->
              <p>Net Exposure</p>
            </a>
          </li>
          <li>
            <a href="{% url 'thirdpage'%}">
              <!-- <i class="now-ui-icons location_map-big"></i> -->
              <p>Factor Contribution</p>
            </a>
          </li>
          <li>
            <a href="{% url 'fourthpage'%}">
              <!-- <i class="now-ui-icons ui-1_bell-53"></i> -->
              <p>Gross Exposure and PnL</p>
            </a>
          </li>
          <li>
            <a href="{% url 'fifthpage'%}">
              <!-- <i class="now-ui-icons users_single-02"></i> -->
              <p>Value at Risk</p>
            </a>
          </li>
          <li>
            <a href="{% url 'sixthpage'%}">
              <!-- <i class="now-ui-icons design_bullet-list-67"></i> -->
              <p>Excess, Vol and Return Disturbution</p>
            </a>
          </li>
          <li >
            <a href="{% url 'logout'%}">
                <!-- <i class="far fa-user mr-2 tm-logout-icon"></i> -->
                <span>Logout<i style="font-size:24px" class="fa">&#xf08b;</i></span>
    
            </a>
        </li>
      
        </ul>
      </div>
    </div>
    <div class="main-panel" id="main-panel">
      <!-- Navbar -->
      <nav class="navbar navbar-expand-lg navbar-transparent  bg-primary  navbar-absolute">
          <div class="container-fluid">
            <div class="navbar-wrapper">
              <div class="navbar-toggle">
                <button type="button" class="navbar-toggler">
                  <span class="navbar-toggler-bar bar1"></span>
                  <span class="navbar-toggler-bar bar2"></span>
                  <span class="navbar-toggler-bar bar3"></span>
                </button>
              </div>
              <h4 style=" text-transform: uppercase;">Growth of $1000-Since Inception</h4>
            </div>
            <!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-bar navbar-kebab"></span>
              <span class="navbar-toggler-bar navbar-kebab"></span>
              <span class="navbar-toggler-bar navbar-kebab"></span>
            </button> -->
            <ul style="float:right">
                <li style="display: inline-block;font-size:13px; text-transform: uppercase;">welcome,&nbsp;{{user}}</li>
          </ul>
          </div>
        </nav>
      <!-- End Navbar -->
      <div class="panel-header panel-header-lg">
        <script src="https://code.highcharts.com/highcharts.js"></script>
        <script src="https://code.highcharts.com/modules/series-label.js"></script>
        <script src="https://code.highcharts.com/modules/exporting.js"></script>
        <script src="https://code.highcharts.com/modules/export-data.js"></script>
        <div  id="container" ></div>
     
            <script>
              Highcharts.chart('container', {
                chart: {
                    backgroundColor: "transparent",
                   
                  },
                title: {
              text: '',
              x: -20 //center
          },
          credits: {
                              enabled: false
                          },
                          exporting: {
                              buttons: {
                                  contextButton: {
                                  enabled:false
                                  },
                                  
                              }
                          },
          xAxis: {
              categories: {{data.dates|safe}},
              tickInterval:50,
              lineColor:"white",
              lineWidth:1,
              tickLength: 7,
              tickWidth: 1,
              tickColor:"white",
              tickColor: 'white',
              labels: {
                  style: {
                      color: 'white',
                  }
                },
          },
          yAxis: {
              title: {
                  text: 'Growth of $1000',
                  style:{
                    color:"white"
                  }
              },
              labels: {
                style: {
                      color: 'white',
                  },
              formatter: function () {
                  return '$' + this.axis.defaultLabelFormatter.call(this);
              }            
            },
              plotLines: [{
                  value: 0,
                  width: 1,
                  color: 'white'
              }],
              gridLineWidth:0,
              lineColor:"white",
              lineWidth:1,
              tickLength: 7,
              tickWidth: 1,
              tickColor:"white",
          },
          tooltip: {
                  pointFormat: '{series.name}: <b>{point.y}</b><br/>',
                  headerFormat: "Date:<b>{point.key} </b><br><br>"
              },
              legend: {
                itemStyle: {
                    color: 'white'
                }  
            },
          series: [{
              name: 'Fund_Cumulative',
              data: {{data.data1|safe}},
              color:"#9ECE58",
          }, {
              name: 'Cumulative_Return_Benchmark',
              data: {{data.data2|safe}},
              color: "#62A5EC"
          }]
            });
</script>
    </div>
    <div class="content">
        <div class="row">
          <div class="col-lg-8">
            <div class="card card-chart">
              <div class="card-header">
                      <script src="https://d3js.org/d3.v4.min.js"></script>
                      <h4 class="card-title">Monthly Perfomance</h4>
                      <!-- <div id="ytd_tab" style="float:left"></div> -->
                      <span id="insertfirsttable" style="float:left;width:80%"></span>
                      <table  id="ytd_table" class="table" style="float:right;max-width:15%;margin-top:-1%">
                        <thead class="text-primary">
                            <th>Year</th>
                            <th>YTD</th>
                        </thead>
                          <tbody id="ytd"></tbody>     
                      </table>
                    </div>
                    <div class="card-body">
                      <script>
                          var ytd={{ytd|safe}}
                          var year={{year|safe}}
                          for(j=0;j<ytd.length;j++)
                          {
                              var table = document.getElementById('ytd')
                              for (var r = 0; r < 1; r += 1) 
                              {
                                  var x = document.getElementById('ytd').insertRow(r);
                                  for (var c = 0; c < 2; c += 1) {
                                  var y = x.insertCell(c);
                                  }
                                  table.rows[r].cells[1].innerHTML = ytd[j];
                                  table.rows[r].cells[0].innerHTML = year[j];
                              }
                          }
                          var margin = {top: 40, right: 0, bottom: 130, left: 100},
                              width = 900,
                              height = 200;
                          // append the svg object to the body of the page
                          var svg = d3.select("#insertfirsttable")
                              .append("svg").attr("viewBox", [0, 0, width+100, height+222])
                              .append("g")
                              .attr("transform","translate(" + margin.left + "," + margin.top + ")");
                          // Labels of row and columns
                          var myGroups =  ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]
                          var myVars = ["2017","2018","2019"]
                          // Build X scales and axis:
                          var x = d3.scaleBand()
                                      .range([ 0, width ])
                                      .domain(myGroups)
                                      .padding(0.01);
                         x_axis=svg.append("g")
                                  .attr("transform", "translate(0," + height + ")").attr("class",'x_ticks')
                                  .call(d3.axisBottom(x))
                          x_axis.selectAll("text").style("fill","black").style("font-size","0.9rem")
                          // Build X scales and axis:
                          var y = d3.scaleBand()
                          .range([ height, 0 ])
                          .domain(myVars)
                          .padding(0.01);
                          y_axis =svg.append("g")
                                      .attr("class", "y axis x_ticks")
                                      .call(d3.axisLeft(y));
                          y_axis.selectAll("text").style("fill","black").style("font-size","1rem")
                      // Build color scale
                      var myColor = d3.scaleLinear()
                        .range(["#FF7474", "#AAFE96"])
                        .domain([-0.05,0.05])
                      //Read the data
                      d3.csv("../static/csv/page1_heatmap.csv", function(data) {
                        // var formatter = d3.format(".0%");
                        svg.selectAll()
                            .data(data, function(d) {return d.Month+':'+d.Year;})
                            .enter()
                            .append("rect")
                            .attr("x", function(d) { return x(d.Month) })
                            .attr("y", function(d) { return y(d.Year) })
                            .attr("width", x.bandwidth() )
                            .attr("height", y.bandwidth() ) 
                            .style("fill", function(d) { return myColor(d.value)} )
                          svg.selectAll()
                            .data(data, function(d) {return d.Month+':'+d.Year;})
                            .enter()
                            .append("text")
                            .attr("x", function(d) { return x(d.Month)+20})
                            .attr("y", function(d) { return y(d.Year)+30})
                            .attr("width", x.bandwidth() )
                            .attr("height", y.bandwidth() )
                            .style("fill","black")
                            .style("font-size","12")
                            .style("font-weight","bold")
                            .text( function(d) {
                              if(d.value) 
                              {
                                num=d.value*100;y=parseFloat(num).toFixed(2);return y+"%";
                              }
                              else
                              return null;
                              })
                      })
                      </script>
                      </div>
              </div>
              </div>
              <div class="col-lg-4 col-md-4">
                  <div class="card card-chart">
                    <div class="card-header">
                      <h4 class="card-title">Portfolio Snapshot</h4>
                      <p style="float:right;" > Select Date: <input type="text" id="dt"   class="column  month_and_year_option i "  required placeholder="DD/MM/YYYY" autocomplete="off" ></p>  
                    </div>
                    <div class="card-body"  >
                        <div class="table-responsive">
                            <table class="table">
                                <thead  class="text-primary">
                                    <th></th><th> Fund</th><th> S&P 500 </th>
                                </thead>
                             <tbody>
                                <tr><td><b>Ann'l Return</b></td><td id="1"></td><td id="2"></td></tr>
                                <tr><td><b>Ann'l  Vol</b></td><td id="3"></td> <td id="4"></td></tr>
                                <tr><td><b>Max Drawdown </b></td><td id="5"></td> <td id="6"></td></tr>
                                <tr><td><b>Sharpe </b> </td><td id="7"></td> <td id="8"></td></tr>
                                <tr><td><b>Sortino </b> </td><td id="9"></td> <td id="10"></td></tr>
                              </tbody>
                            </table>
                          </div>
                    </div>
                  </div>
                </div>


            </div>
          </div>
         
        </div>
      </div>
    </div>
  </div>
  <!--   Core JS Files   -->
  <script src="../static/assets/js/core/jquery.min.js"></script>
  <script src="../static/assets/js/core/popper.min.js"></script>
  <script src="../static/assets/js/core/bootstrap.min.js"></script>
  <script src="../static/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
  <!--  Google Maps Plugin    -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
  <!-- Chart JS -->
  <script src="../static/assets/js/plugins/chartjs.min.js"></script>
  <!--  Notifications Plugin    -->
  <script src="../static/assets/js/plugins/bootstrap-notify.js"></script>
  <!-- Control Center for Now Ui Dashboard: parallax effects, scripts for the example pages etc -->
  <script src="../static/assets/js/now-ui-dashboard.min.js?v=1.3.0" type="text/javascript"></script>
  <!-- Now Ui Dashboard DEMO methods, don't include it in your project! -->
  <script src="../static/assets/demo/demo.js"></script>
  <script>
    $(document).ready(function() {
      demo.initDashboardPageCharts();
    });
    var data={{data2|safe}}  
            $(function(){
                $( "#dt" ).datepicker({
                    changeMonth : true,
                    changeYear : true,
                    dateFormat : 'dd/mm/yy'
                });
            });
      $(function(){
                $("#dt").on("change",function(){
                selected_date=$('#dt').val();
                table_data(selected_date)
                })
            });
            function table_data(selected_date)
                    {
                    sort_data=data.filter((item) => item.Trade_Dt === selected_date )
                    data2=sort_data;
                    if(sort_data.length!=0)
                    {
                    if(data2[0]['Annl Fund '])
                        document.getElementById("1").innerHTML=data2[0]['Annl Fund '];
                    else
                        document.getElementById("1").innerHTML=null;
                    if(data2[0]['Annl Benchmark'])
                        document.getElementById("2").innerHTML= parseFloat(data2[0]['Annl Benchmark']*100).toFixed(2)+"%"
                    else 
                        document.getElementById("2").innerHTML=null;
                    if(data2[0]["Ann'l Fund Vol"])
                        document.getElementById("3").innerHTML=data2[0]["Ann'l Fund Vol"]
                    else 
                        document.getElementById("3").innerHTML=null;    
                    if(data2[0]["Ann'l Benchmark Vol"])   
                        document.getElementById("4").innerHTML=parseFloat(data2[0]["Ann'l Benchmark Vol"]*100).toFixed(2)+"%"
                    else 
                        document.getElementById("4").innerHTML=null;
                    if(data2[0]['Max Drawdown - Fund'])
                        document.getElementById("5").innerHTML =data2[0]['Max Drawdown - Fund']
                    else 
                        document.getElementById("5").innerHTML=null;
                    if(data2[0]['Max Drawdown - Bench Mark'])
                        document.getElementById("6").innerHTML=data2[0]['Max Drawdown - Bench Mark']
                    else 
                        document.getElementById("6").innerHTML=null;
                    if(data2[0]['Sharpe - Fund'])
                        document.getElementById("7").innerHTML =data2[0]['Sharpe - Fund']
                    else 
                        document.getElementById("7").innerHTML=null;
                    if(data2[0]['Sharpe - Benchmark'])
                        document.getElementById("8").innerHTML =data2[0]['Sharpe - Benchmark']
                    else 
                        document.getElementById("8").innerHTML=null;
                    if(data2[0]['Sortino - Fund'])
                        document.getElementById("9").innerHTML =data2[0]['Sortino - Fund']
                    else 
                        document.getElementById("9").innerHTML=null;
                    if(data2[0]['Sortino - Benchmark'])
                        document.getElementById("10").innerHTML=data2[0]['Sortino - Benchmark']
                    else 
                        document.getElementById("10").innerHTML=null;
                    }
                        else
                        {
                                    document.getElementById("1").innerHTML=null;
                                    document.getElementById("2").innerHTML=null;
                                    document.getElementById("3").innerHTML=null;    
                                    document.getElementById("4").innerHTML=null;    
                                    document.getElementById("5").innerHTML=null;    
                                    document.getElementById("6").innerHTML=null;    
                                    document.getElementById("7").innerHTML=null;    
                                    document.getElementById("8").innerHTML=null;    
                                    document.getElementById("9").innerHTML=null;    
                                    document.getElementById("10").innerHTML=null; 
                        }
                    }
            </script>
</body>
</html>
